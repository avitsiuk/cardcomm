<!DOCTYPE html><html class="default" lang="en"><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>Smartcard Library Documentation</title><meta name="description" content="Documentation for Smartcard Library Documentation"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script defer src="assets/main.js"></script><script async src="assets/icons.js" id="tsd-icons-script"></script><script async src="assets/search.js" id="tsd-search-script"></script><script async src="assets/navigation.js" id="tsd-nav-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search" data-base="."><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">Smartcard Library Documentation</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><h2>Smartcard Library Documentation</h2></div><div class="tsd-panel tsd-typography"><a id="md:about" class="tsd-anchor"></a><h1 class="tsd-anchor-link">About<a href="#md:about" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h1><p>This library is a refactoring with added typings of <a href="https://github.com/tomkp/smartcard"><code>smartcard</code> library</a> by <a href="https://github.com/tomkp">tomkp</a> and is built around <a href="https://github.com/santigimeno/node-pcsclite"><code>pcsclite</code> library</a> by <a href="https://github.com/santigimeno">Santiago Gimeno</a><br>
<a href="https://www.npmjs.com/package/smartcard">Original <code>smartcard</code> package</a> on NPM<br>
<a href="https://www.npmjs.com/package/pcsclite"><code>pcsclite</code> package</a> on NPM</p>
<blockquote>
<p>Tested with <code>ACR39U</code> and <code>ACR122U</code> readers</p>
</blockquote>
<a id="md:dependencies-and-problems-debianubuntu" class="tsd-anchor"></a><h1 class="tsd-anchor-link">Dependencies and problems (Debian/Ubuntu)<a href="#md:dependencies-and-problems-debianubuntu" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h1><a id="md:pcsc" class="tsd-anchor"></a><h2 class="tsd-anchor-link">PCSC<a href="#md:pcsc" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Install basic dependencies by running<br>
<code>sudo apt install libpcsclite1 libpcsclite-dev pcscd</code><br>
and check pcscd service status for any error with<br>
<code>service pcscd status</code></p>
<p>Optionally install pcsc tools package<br>
<code>sudo apt install pcsc-tools</code><br>
and check if your reader(s) and card(s) are working by executing<br>
<code>pcsc_scan</code><br>
This should show all (contact and NFC) readers recognized by your system and print info about inserted cards (if any).</p>
<a id="md:nfc-issues" class="tsd-anchor"></a><h2 class="tsd-anchor-link">NFC issues<a href="#md:nfc-issues" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Sometimes NFC readers won't work because of other drivers blocking the usb bus.
Plug in your reader and check pcscd service logs:</p>
<pre><code><span class="hl-0">$</span><span class="hl-1"> </span><span class="hl-0">journalctl</span><span class="hl-1"> -</span><span class="hl-0">u</span><span class="hl-1"> </span><span class="hl-0">pcscd</span><span class="hl-1">.</span><span class="hl-0">service</span><br/><span class="hl-1">...</span><br/><span class="hl-0">xxx</span><span class="hl-1"> </span><span class="hl-2">XX</span><span class="hl-1"> </span><span class="hl-3">XX</span><span class="hl-1">:</span><span class="hl-3">XX</span><span class="hl-1">:</span><span class="hl-2">XX</span><span class="hl-1"> </span><span class="hl-0">xxxxxx</span><span class="hl-1"> </span><span class="hl-0">pcscd</span><span class="hl-1">[</span><span class="hl-4">5465</span><span class="hl-1">]: </span><span class="hl-4">29870365</span><span class="hl-1"> </span><span class="hl-0">ccid_usb</span><span class="hl-1">.</span><span class="hl-0">c</span><span class="hl-1">:</span><span class="hl-4">672</span><span class="hl-1">:</span><span class="hl-5">OpenUSBByName</span><span class="hl-1">() </span><span class="hl-0">Can</span><span class="hl-6">&#39;t claim interface 1/10: LIBUSB_ERROR_BUS</span><span class="hl-7">Y</span><br/><span class="hl-1">...</span>
</code><button>Copy</button></pre>

<p><code>LIBUSB_ERROR_BUSY</code> tells that the interface is used by something else.</p>
<p>Check what driver is using the device:</p>
<pre><code><span class="hl-0">$</span><span class="hl-1"> </span><span class="hl-0">lsusb</span><span class="hl-1"> -</span><span class="hl-0">t</span><br/><span class="hl-1">/:  </span><span class="hl-0">Bus</span><span class="hl-1"> </span><span class="hl-4">01</span><span class="hl-1">.</span><span class="hl-0">Port</span><span class="hl-1"> </span><span class="hl-4">1</span><span class="hl-1">: </span><span class="hl-0">Dev</span><span class="hl-1"> </span><span class="hl-4">1</span><span class="hl-1">, </span><span class="hl-0">Class</span><span class="hl-1">=</span><span class="hl-0">root_hub</span><span class="hl-1">, </span><span class="hl-0">Driver</span><span class="hl-1">=</span><span class="hl-0">xhci_hcd</span><span class="hl-1">/16</span><span class="hl-0">p</span><span class="hl-1">, 480</span><span class="hl-2">M</span><br/><span class="hl-1">    |</span><span class="hl-0">__</span><span class="hl-1"> </span><span class="hl-0">Port</span><span class="hl-1"> </span><span class="hl-4">1</span><span class="hl-1">: </span><span class="hl-0">Dev</span><span class="hl-1"> </span><span class="hl-4">23</span><span class="hl-1">, </span><span class="hl-0">If</span><span class="hl-1"> </span><span class="hl-4">0</span><span class="hl-1">, </span><span class="hl-0">Class</span><span class="hl-1">=</span><span class="hl-0">Chip</span><span class="hl-1">/</span><span class="hl-0">SmartCard</span><span class="hl-1">, </span><span class="hl-0">Driver</span><span class="hl-1">=</span><span class="hl-0">pn533</span><span class="hl-1">, 12</span><span class="hl-2">M</span>
</code><button>Copy</button></pre>

<p>Then view the dependency tree of that driver (<code>pn533</code> in this case)</p>
<pre><code><span class="hl-0">$</span><span class="hl-1"> </span><span class="hl-0">lsmod</span><span class="hl-1"> | </span><span class="hl-0">grep</span><span class="hl-1"> </span><span class="hl-0">pn533</span><br/><span class="hl-0">Module</span><span class="hl-1">                  </span><span class="hl-0">Size</span><span class="hl-1">  </span><span class="hl-0">Used</span><span class="hl-1"> </span><span class="hl-0">by</span><br/><span class="hl-0">pn533_usb</span><span class="hl-1">              </span><span class="hl-4">20480</span><span class="hl-1">  </span><span class="hl-4">0</span><br/><span class="hl-0">pn533</span><span class="hl-1">                  </span><span class="hl-4">49152</span><span class="hl-1">  </span><span class="hl-4">1</span><span class="hl-1"> </span><span class="hl-0">pn533_usb</span><br/><span class="hl-0">nfc</span><span class="hl-1">                   </span><span class="hl-4">147456</span><span class="hl-1">  </span><span class="hl-4">1</span><span class="hl-1"> </span><span class="hl-0">pn533</span>
</code><button>Copy</button></pre>

<p>in this case we have following dependency tree</p>
<pre><code><span class="hl-0">pn533_usb</span><br/><span class="hl-1">  └</span><span class="hl-0">pn533</span><br/><span class="hl-1">    └</span><span class="hl-0">nfc</span>
</code><button>Copy</button></pre>

<p>There are two possible ways to disable those drivers:</p>
<ol>
<li>
<p>Unload modules from kernel:<br>
<code>sudo rmmod pn533_usb pn533 nfc</code><br>
In case you need to reenable them again just run:<br>
<code>sudo modprobe pn533_usb pn533 nfc</code></p>
<blockquote>
<p>No system reboot required</p>
</blockquote>
</li>
<li>
<p>Add drivers to blacklist<br>
Open(create) file <code>/etc/modprobe.d/nfc-blacklist.conf</code> and add following lines:</p>
<pre><code><span class="hl-0">blacklist</span><span class="hl-1"> </span><span class="hl-0">pn533_usb</span><br/><span class="hl-0">blacklist</span><span class="hl-1"> </span><span class="hl-0">pn533</span><br/><span class="hl-0">blacklist</span><span class="hl-1"> </span><span class="hl-0">nfc</span>
</code><button>Copy</button></pre>

<blockquote>
<p>System reboot required</p>
</blockquote>
</li>
</ol>
<p>Now install <code>libnfc</code>:<br>
<code>sudo apt install libnfc-bin</code></p>
<p>And finally restart <code>pcscd</code>:<br>
<code>sudo service pcscd restart</code></p>
<p>Use one of the following tools to check if the reader is working:</p>
<pre><code><span class="hl-0">$</span><span class="hl-1"> </span><span class="hl-0">nfc</span><span class="hl-1">-</span><span class="hl-0">scan</span><span class="hl-1">-</span><span class="hl-0">device</span><br/><span class="hl-0">nfc</span><span class="hl-1">-</span><span class="hl-0">scan</span><span class="hl-1">-</span><span class="hl-0">device</span><span class="hl-1"> </span><span class="hl-0">uses</span><span class="hl-1"> </span><span class="hl-0">libnfc</span><span class="hl-1"> </span><span class="hl-4">1.8</span><span class="hl-1">.</span><span class="hl-4">0</span><br/><span class="hl-4">1</span><span class="hl-1"> </span><span class="hl-2">NFC</span><span class="hl-1"> </span><span class="hl-5">device</span><span class="hl-1">(</span><span class="hl-0">s</span><span class="hl-1">) </span><span class="hl-3">found</span><span class="hl-1">:</span><br/><span class="hl-1">- </span><span class="hl-2">ACS</span><span class="hl-1"> / </span><span class="hl-2">ACR122U</span><span class="hl-1"> </span><span class="hl-2">PICC</span><span class="hl-1"> </span><span class="hl-3">Interface</span><span class="hl-1">:</span><br/><span class="hl-1">    </span><span class="hl-3">acr122_usb</span><span class="hl-1">:</span><span class="hl-4">001</span><span class="hl-1">:</span><span class="hl-4">023</span>
</code><button>Copy</button></pre>

<pre><code><span class="hl-0">$</span><span class="hl-1"> </span><span class="hl-0">nfc</span><span class="hl-1">-</span><span class="hl-0">list</span><br/><span class="hl-0">nfc</span><span class="hl-1">-</span><span class="hl-0">list</span><span class="hl-1"> </span><span class="hl-0">uses</span><span class="hl-1"> </span><span class="hl-0">libnfc</span><span class="hl-1"> </span><span class="hl-4">1.8</span><span class="hl-1">.</span><span class="hl-4">0</span><br/><span class="hl-2">NFC</span><span class="hl-1"> </span><span class="hl-3">device</span><span class="hl-1">: </span><span class="hl-2">ACS</span><span class="hl-1"> / </span><span class="hl-2">ACR122U</span><span class="hl-1"> </span><span class="hl-2">PICC</span><span class="hl-1"> </span><span class="hl-0">Interface</span><span class="hl-1"> </span><span class="hl-0">opened</span>
</code><button>Copy</button></pre>

<pre><code><span class="hl-0">$</span><span class="hl-1"> </span><span class="hl-0">pcsc_scan</span><br/><span class="hl-0">Using</span><span class="hl-1"> </span><span class="hl-0">reader</span><span class="hl-1"> </span><span class="hl-0">plug</span><span class="hl-6">&#39;n play mechanis</span><span class="hl-7">m</span><br/><span class="hl-0">Scanning</span><span class="hl-1"> </span><span class="hl-0">present</span><span class="hl-1"> </span><span class="hl-0">readers</span><span class="hl-1">...</span><br/><span class="hl-4">0</span><span class="hl-1">: </span><span class="hl-2">ACS</span><span class="hl-1"> </span><span class="hl-2">ACR122U</span><span class="hl-1"> </span><span class="hl-2">PICC</span><span class="hl-1"> </span><span class="hl-0">Interface</span><span class="hl-1"> </span><span class="hl-4">00</span><span class="hl-1"> </span><span class="hl-4">00</span><br/><span class="hl-1"> </span><br/><span class="hl-0">Fri</span><span class="hl-1"> </span><span class="hl-0">Aug</span><span class="hl-1"> </span><span class="hl-4">23</span><span class="hl-1"> </span><span class="hl-4">16</span><span class="hl-1">:</span><span class="hl-4">47</span><span class="hl-1">:</span><span class="hl-4">33</span><span class="hl-1"> </span><span class="hl-4">2024</span><br/><span class="hl-1"> </span><span class="hl-0">Reader</span><span class="hl-1"> </span><span class="hl-4">0</span><span class="hl-1">: </span><span class="hl-2">ACS</span><span class="hl-1"> </span><span class="hl-2">ACR122U</span><span class="hl-1"> </span><span class="hl-2">PICC</span><span class="hl-1"> </span><span class="hl-0">Interface</span><span class="hl-1"> </span><span class="hl-4">00</span><span class="hl-1"> </span><span class="hl-4">00</span><br/><span class="hl-1">  </span><span class="hl-0">Event</span><span class="hl-1"> </span><span class="hl-3">number</span><span class="hl-1">: </span><span class="hl-4">0</span><br/><span class="hl-1">  </span><span class="hl-0">Card</span><span class="hl-1"> </span><span class="hl-3">state</span><span class="hl-1">: </span><span class="hl-0">Card</span><span class="hl-1"> </span><span class="hl-0">removed</span><span class="hl-1">,</span>
</code><button>Copy</button></pre>

<a id="md:api" class="tsd-anchor"></a><h2 class="tsd-anchor-link">API<a href="#md:api" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The following objects are defined by the <code>smartcard</code> library, each contains its own set of methods and events.</p>
<a id="md:class-devices" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Class: Devices<a href="#md:class-devices" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>A general object that provides access to all smartcard related devices.</p>
<a id="md:events" class="tsd-anchor"></a><h4 class="tsd-anchor-link">Events<a href="#md:events" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><p>The <code>devices</code> object emits the following events</p>
<a id="md:event-device-activated" class="tsd-anchor"></a><h5 class="tsd-anchor-link">Event: 'device-activated'<a href="#md:event-device-activated" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h5><p>Emitted when a card reader is attached.
Returns:</p>
<ul>
<li><code>Object</code>
<ul>
<li><code>Device</code></li>
<li><code>Array</code>: List of all devices, returned via <code>devices.listDevices()</code></li>
</ul>
</li>
</ul>
<a id="md:event-device-deactivated" class="tsd-anchor"></a><h5 class="tsd-anchor-link">Event: 'device-deactivated'<a href="#md:event-device-deactivated" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h5><p>Emitted when a card reader is detached.
Returns:</p>
<ul>
<li><code>Object</code>
<ul>
<li><code>Device</code></li>
<li><code>Array</code>: List of all devices, returned via <code>devices.listDevices()</code></li>
</ul>
</li>
</ul>
<a id="md:event-error" class="tsd-anchor"></a><h5 class="tsd-anchor-link">Event: 'error'<a href="#md:event-error" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h5><p>Emitted when an error occurs
Returns <code>Object</code>:</p>
<ul>
<li><em>error</em> <code>Error</code></li>
</ul>
<a id="md:methods" class="tsd-anchor"></a><h4 class="tsd-anchor-link">Methods<a href="#md:methods" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><p>The following methods are available within the <code>devices</code> class.</p>
<a id="md:constructor" class="tsd-anchor"></a><h5 class="tsd-anchor-link">Constructor<a href="#md:constructor" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h5><p>The constructor for a devices object takes no arguments,</p>
<pre><code class="javascript"><span class="hl-0">devices</span><span class="hl-1"> = </span><span class="hl-8">new</span><span class="hl-1"> </span><span class="hl-5">Devices</span><span class="hl-1">();</span>
</code><button type="button">Copy</button></pre>

<a id="md:devicesonactivated" class="tsd-anchor"></a><h5 class="tsd-anchor-link"><code>devices.onActivated()</code><a href="#md:devicesonactivated" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h5><p>Returns <code>Promise</code></p>
<ul>
<li>Resolves with activation <em>event</em></li>
</ul>
<a id="md:devicesondeactivated" class="tsd-anchor"></a><h5 class="tsd-anchor-link"><code>devices.onDeactivated()</code><a href="#md:devicesondeactivated" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h5><p>Returns <code>Promise</code></p>
<ul>
<li>Resolves with deactivation <em>event</em></li>
</ul>
<a id="md:deviceslistdevices" class="tsd-anchor"></a><h5 class="tsd-anchor-link"><code>devices.listDevices()</code><a href="#md:deviceslistdevices" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h5><p>Returns <code>Object</code> a list of the different devices attached, each a <code>device</code> object</p>
<a id="md:deviceslookupname" class="tsd-anchor"></a><h5 class="tsd-anchor-link"><code>devices.lookup(name)</code><a href="#md:deviceslookupname" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h5><ul>
<li>
<p><em>name</em> <code>String</code>: The text name of a device</p>
</li>
<li>
<p>Returns <code>Device</code></p>
</li>
</ul>
<a id="md:class-device" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Class: Device<a href="#md:class-device" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>An object representing a specific card reader (device).</p>
<a id="md:methods-1" class="tsd-anchor"></a><h4 class="tsd-anchor-link">Methods<a href="#md:methods-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><p>The following methods are available within the <code>device</code> class.</p>
<a id="md:devicegetname" class="tsd-anchor"></a><h5 class="tsd-anchor-link"><code>device.getName()</code><a href="#md:devicegetname" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h5><p>Returns the name of the attached device.</p>
<a id="md:devicetransmitdata-res_len-protocol-cb" class="tsd-anchor"></a><h5 class="tsd-anchor-link"><code>device.transmit(data, res_len, protocol, cb)</code><a href="#md:devicetransmitdata-res_len-protocol-cb" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h5><p>Sends a command to the connected device</p>
<ul>
<li><em>data</em> <code>Buffer</code>: data to be transmitted</li>
<li><em>res_len</em> <code>Number</code>: Maximum length of the expected response, includes the 2 byte response (sw1 and sw2)</li>
<li><em>protocol</em> <code>Number</code>: Protocol to be used in the transmission</li>
<li><em>cb(error,response)</em> <code>Function</code>: Called when transmit function completes
<ul>
<li><em>error</em> <code>Error</code></li>
<li><em>output</em> <code>Buffer</code></li>
</ul>
</li>
</ul>
<a id="md:events-1" class="tsd-anchor"></a><h4 class="tsd-anchor-link">Events<a href="#md:events-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><p>The <code>device</code> object emits the following events</p>
<a id="md:event-card-inserted" class="tsd-anchor"></a><h5 class="tsd-anchor-link">Event: 'card-inserted'<a href="#md:event-card-inserted" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h5><p>Emitted when a smartcard is inserted into a card reader</p>
<p>Returns <code>Object</code>:</p>
<ul>
<li><em>device</em> <code>Device</code></li>
<li><em>card</em> <code>Card</code></li>
</ul>
<a id="md:event-card-removed" class="tsd-anchor"></a><h5 class="tsd-anchor-link">Event: 'card-removed'<a href="#md:event-card-removed" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h5><p>Emitted when a smartcard is removed from a card reader</p>
<p>Returns <code>Object</code>:</p>
<ul>
<li><em>name</em> <code>String</code></li>
<li><em>card</em> <code>Card</code></li>
</ul>
<a id="md:class-card" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Class: Card<a href="#md:class-card" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>An object representing an attached smart card.</p>
<a id="md:methods-2" class="tsd-anchor"></a><h4 class="tsd-anchor-link">Methods<a href="#md:methods-2" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><p>The following methods are available within the <code>card</code> class.</p>
<a id="md:cardgetatr" class="tsd-anchor"></a><h5 class="tsd-anchor-link"><code>card.getAtr()</code><a href="#md:cardgetatr" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h5><p>Returns <code>String</code> containing the atr of the card</p>
<a id="md:cardissuecommandcommandapdu-callback" class="tsd-anchor"></a><h5 class="tsd-anchor-link"><code>card.issueCommand(commandApdu, callback)</code><a href="#md:cardissuecommandcommandapdu-callback" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h5><p>Sends a command to the card</p>
<ul>
<li><em>commandApdu</em>: The command to be sent to the card
<ul>
<li><code>String</code></li>
<li><code>Buffer</code></li>
<li><code>Array</code></li>
<li><code>CommandApdu</code></li>
</ul>
</li>
<li><em>callback(error,response)</em>: (optional) Function to call upon completion of the command
<ul>
<li><em>error</em> <code>Error</code></li>
<li><em>response</em> <code>Buffer</code></li>
</ul>
</li>
</ul>
<p>Returns <code>Promise</code></p>
<ul>
<li>Resolves with <em>response</em> <code>Buffer</code></li>
<li>Rejects with <em>error</em> <code>Error</code></li>
</ul>
<p>If no callback is specified, returns a <code>Promise</code>
*</p>
<a id="md:events-2" class="tsd-anchor"></a><h4 class="tsd-anchor-link">Events<a href="#md:events-2" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><p>The <code>card</code> object emits the following events</p>
<a id="md:event-command-issued" class="tsd-anchor"></a><h5 class="tsd-anchor-link">Event: 'command-issued'<a href="#md:event-command-issued" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h5><p>Emitted when a command is sent to the smartcard.</p>
<p>Returns <code>Object</code>:</p>
<ul>
<li><em>card</em> <code>Card</code></li>
<li><em>command</em> <code>Buffer</code></li>
</ul>
<a id="md:event-response-received" class="tsd-anchor"></a><h5 class="tsd-anchor-link">Event: 'response-received'<a href="#md:event-response-received" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h5><p>Emitted when a response is received from the card.</p>
<p>Returns <code>Object</code>:</p>
<ul>
<li><em>card</em> <code>Card</code></li>
<li><em>command</em> <code>Buffer</code></li>
<li><em>response</em> <code>ResponseApdu</code></li>
</ul>
<a id="md:class-commandapdu" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Class: CommandApdu<a href="#md:class-commandapdu" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>An object representing a command to send to a smart card</p>
<a id="md:methods-3" class="tsd-anchor"></a><h4 class="tsd-anchor-link">Methods<a href="#md:methods-3" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><p>The <code>CommandApdu</code> class has the following methods.</p>
<a id="md:constructor-commandapduobj" class="tsd-anchor"></a><h5 class="tsd-anchor-link">Constructor <code>CommandApdu(obj)</code><a href="#md:constructor-commandapduobj" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h5><p>Creates a new instance and sets the appropriate items</p>
<ul>
<li><em>obj</em> <code>Object</code>
<ul>
<li><em>cla</em> <code>Number</code>: The class of the command, typically 0</li>
<li><em>ins</em> <code>Number</code>: The instruction</li>
<li><em>p1</em> <code>Number</code>: The value of p1</li>
<li><em>p2</em> <code>Number</code>: The value of p2</li>
<li><em>data</em> <code>Array</code> (optional): The value of data</li>
<li><em>le</em> <code>Number</code> (optional): The value of le</li>
</ul>
</li>
</ul>
<p>OR</p>
<ul>
<li><em>obj</em> <code>Array</code>: Byte array representing the whole command</li>
</ul>
<a id="md:commandapdutobuffer" class="tsd-anchor"></a><h5 class="tsd-anchor-link"><code>CommandApdu.toBuffer()</code><a href="#md:commandapdutobuffer" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h5><p>Converts the command to a Buffer</p>
<ul>
<li>Returns <code>Buffer</code></li>
</ul>
<a id="md:commandapdutostring" class="tsd-anchor"></a><h5 class="tsd-anchor-link"><code>CommandApdu.toString()</code><a href="#md:commandapdutostring" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h5><p>Converts the command to a hex string</p>
<ul>
<li>Returns <code>String</code></li>
</ul>
<a id="md:commandapdutobytearray" class="tsd-anchor"></a><h5 class="tsd-anchor-link"><code>CommandApdu.toByteArray()</code><a href="#md:commandapdutobytearray" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h5><p>Converts the command to a byte array</p>
<ul>
<li>Returns <code>Array</code></li>
</ul>
<a id="md:commandapdusetlele" class="tsd-anchor"></a><h5 class="tsd-anchor-link"><code>CommandApdu.setLe(le)</code><a href="#md:commandapdusetlele" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h5><p>Updates the le value of the command</p>
<ul>
<li><em>le</em> <code>Number</code>: The new le value</li>
</ul>
<a id="md:class-responseapdu" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Class: ResponseApdu<a href="#md:class-responseapdu" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Class representing a response from the card</p>
<a id="md:methods-4" class="tsd-anchor"></a><h4 class="tsd-anchor-link">Methods<a href="#md:methods-4" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><p>The <code>ResponseApdu</code> class has the following methods.</p>
<a id="md:constructor-1" class="tsd-anchor"></a><h5 class="tsd-anchor-link">Constructor<a href="#md:constructor-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h5><a id="md:responseapdumeaning" class="tsd-anchor"></a><h5 class="tsd-anchor-link"><code>ResponseApdu.meaning()</code><a href="#md:responseapdumeaning" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h5><p>Interprets the return code and attempts to provide a text translation.</p>
<ul>
<li>Returns <code>String</code></li>
</ul>
<a id="md:responseapdugetdataonly" class="tsd-anchor"></a><h5 class="tsd-anchor-link"><code>ResponseApdu.getDataOnly()</code><a href="#md:responseapdugetdataonly" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h5><p>Returns the response data without including the status code</p>
<ul>
<li>Returns <code>String</code></li>
</ul>
<a id="md:responseapdugetstatuscode" class="tsd-anchor"></a><h5 class="tsd-anchor-link"><code>ResponseApdu.getStatusCode()</code><a href="#md:responseapdugetstatuscode" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h5><p>Returns only the status code</p>
<ul>
<li>Returns <code>String</code></li>
</ul>
<a id="md:responseapduisok" class="tsd-anchor"></a><h5 class="tsd-anchor-link"><code>ResponseApdu.isOk()</code><a href="#md:responseapduisok" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h5><p>Check if the status code is 9000</p>
<ul>
<li>Returns <code>Boolean</code></li>
</ul>
<a id="md:responseapdubuffer" class="tsd-anchor"></a><h5 class="tsd-anchor-link"><code>ResponseApdu.buffer()</code><a href="#md:responseapdubuffer" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h5><p>Returns the whole buffer, status code and data</p>
<ul>
<li>Returns <code>Buffer</code></li>
</ul>
<a id="md:responseapduhasmorebytesavailable" class="tsd-anchor"></a><h5 class="tsd-anchor-link"><code>ResponseApdu.hasMoreBytesAvailable()</code><a href="#md:responseapduhasmorebytesavailable" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h5><p>Reads the status code and looks for a 61 as sw1, meaning more data is available</p>
<ul>
<li>Returns <code>Boolean</code></li>
</ul>
<a id="md:responseapdunumberofbytesavailable" class="tsd-anchor"></a><h5 class="tsd-anchor-link"><code>ResponseApdu.numberOfBytesAvailable()</code><a href="#md:responseapdunumberofbytesavailable" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h5><p>Reads sw2 staus code to return number of bytes left, when sw1 is 61. A value of 0 means there are more than 256 bytes remaining.</p>
<ul>
<li>Returns <code>Number</code></li>
</ul>
<a id="md:responseapduiswronglength" class="tsd-anchor"></a><h5 class="tsd-anchor-link"><code>ResponseApdu.isWrongLength()</code><a href="#md:responseapduiswronglength" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h5><p>Checks status code for 6c as sw1</p>
<ul>
<li>Returns <code>Boolean</code></li>
</ul>
<a id="md:responseapducorrectlength" class="tsd-anchor"></a><h5 class="tsd-anchor-link"><code>ResponseApdu.correctLength()</code><a href="#md:responseapducorrectlength" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h5><p>If sw1 is 6c, returns the correct length from sw2. A value of 0 means there are more than 256 bytes remaining.</p>
<ul>
<li>Returns <code>Number</code></li>
</ul>
<a id="md:class-iso7816application" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Class: Iso7816Application<a href="#md:class-iso7816application" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>An object offering general commands to most ISO7816 compliant smart cards.</p>
<a id="md:methods-5" class="tsd-anchor"></a><h4 class="tsd-anchor-link">Methods<a href="#md:methods-5" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><a id="md:constructor-iso7816applicationcard" class="tsd-anchor"></a><h5 class="tsd-anchor-link">Constructor <code>Iso7816Application(card)</code><a href="#md:constructor-iso7816applicationcard" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h5><p>Sets up the <code>Iso7816Application</code> object</p>
<ul>
<li><em>card</em> <code>Card</code>: The card to communicate with using ISO7816 standards</li>
</ul>
<a id="md:iso7816applicationissuecommandcommandapdu" class="tsd-anchor"></a><h5 class="tsd-anchor-link"><code>Iso7816Application.issueCommand(commandApdu)</code><a href="#md:iso7816applicationissuecommandcommandapdu" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h5><p>Sends the provided command to the card. Automatically retrieve the full response, even if it requires multiple GET_RESPONSE commands</p>
<ul>
<li><em>commandApdu</em> <code>CommandApdu</code>: Command to send to the card</li>
</ul>
<p>Returns</p>
<ul>
<li><code>ResponseApdu</code> Complete response from card</li>
</ul>
<a id="md:iso7816applicationselectfilebytes-p1-p2" class="tsd-anchor"></a><h5 class="tsd-anchor-link"><code>Iso7816Application.selectFile(bytes, p1, p2)</code><a href="#md:iso7816applicationselectfilebytes-p1-p2" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h5><p>Sends the SELECT command to the card, often called selecting an application</p>
<ul>
<li><em>bytes</em> <code>Buffer</code>: The resource locater (AID, etc)</li>
<li><em>p1</em> <code>Number</code>: Value to specify as the p1 value</li>
<li><em>p2</em> <code>Number</code>: Value to specify as the p2 value</li>
</ul>
<p>Returns</p>
<ul>
<li><code>ResponseApdu</code> Complete response from card</li>
</ul>
<a id="md:iso7816applicationgetresponselength" class="tsd-anchor"></a><h5 class="tsd-anchor-link"><code>Iso7816Application.getResponse(length)</code><a href="#md:iso7816applicationgetresponselength" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h5><p>Sends a single GET_RESPONSE command to the card</p>
<ul>
<li><em>length</em> <code>Number</code>: The length of the response expected, maximum is 0xFF</li>
</ul>
<p>Returns</p>
<ul>
<li><code>ResponseApdu</code> Complete response from card</li>
</ul>
<a id="md:iso7816applicationgetresponsesfirecord" class="tsd-anchor"></a><h5 class="tsd-anchor-link"><code>Iso7816Application.getResponse(sfi,record)</code><a href="#md:iso7816applicationgetresponsesfirecord" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h5><p>Sends a READ_RECORD command to the card</p>
<ul>
<li><em>sfi</em> <code>Number</code>: The sfi</li>
<li><em>record</em> <code>Number</code>: The record</li>
</ul>
<p>Returns</p>
<ul>
<li><code>ResponseApdu</code> Complete response from card</li>
</ul>
<a id="md:iso7816applicationgetdatap1-p2" class="tsd-anchor"></a><h5 class="tsd-anchor-link"><code>Iso7816Application.getData(p1, p2)</code><a href="#md:iso7816applicationgetdatap1-p2" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h5><p>Sends a GET_DATA command to the card</p>
<ul>
<li><em>p1</em> <code>Number</code>: Value to specify as the p1 value</li>
<li><em>p2</em> <code>Number</code>: Value to specify as the p2 value</li>
</ul>
<p>Returns</p>
<ul>
<li><code>ResponseApdu</code> Complete response from card</li>
</ul>
<a id="md:events-3" class="tsd-anchor"></a><h4 class="tsd-anchor-link">Events<a href="#md:events-3" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><p>The <code>Iso7816Application</code> class emits the following events</p>
<a id="md:event-application-selected" class="tsd-anchor"></a><h5 class="tsd-anchor-link">Event: 'application-selected'<a href="#md:event-application-selected" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h5><p>Emitted when a successful reply to a <code>selectFile()</code> command is received.</p>
<p>Returns <code>Object</code>:</p>
<ul>
<li><em>application</em> <code>String</code></li>
</ul>
<a id="md:examples" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Examples<a href="#md:examples" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="md:with-event-emitter" class="tsd-anchor"></a><h3 class="tsd-anchor-link">With event emitter<a href="#md:with-event-emitter" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="javascript"><span class="hl-6">&#39;use strict&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-8">const</span><span class="hl-1"> </span><span class="hl-2">smartcard</span><span class="hl-1"> = </span><span class="hl-5">require</span><span class="hl-1">(</span><span class="hl-6">&#39;smartcard&#39;</span><span class="hl-1">);</span><br/><span class="hl-8">const</span><span class="hl-1"> </span><span class="hl-2">Devices</span><span class="hl-1"> = </span><span class="hl-0">smartcard</span><span class="hl-1">.</span><span class="hl-0">Devices</span><span class="hl-1">;</span><br/><span class="hl-8">const</span><span class="hl-1"> </span><span class="hl-2">devices</span><span class="hl-1"> = </span><span class="hl-8">new</span><span class="hl-1"> </span><span class="hl-5">Devices</span><span class="hl-1">();</span><br/><br/><br/><span class="hl-0">devices</span><span class="hl-1">.</span><span class="hl-5">on</span><span class="hl-1">(</span><span class="hl-6">&#39;device-activated&#39;</span><span class="hl-1">, (</span><span class="hl-0">event</span><span class="hl-1"> </span><span class="hl-8">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-6">`Device &#39;</span><span class="hl-8">${</span><span class="hl-0">event</span><span class="hl-9">.</span><span class="hl-0">device</span><span class="hl-8">}</span><span class="hl-6">&#39; activated`</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-0">event</span><span class="hl-1">.</span><span class="hl-0">devices</span><span class="hl-1">.</span><span class="hl-5">map</span><span class="hl-1">((</span><span class="hl-0">device</span><span class="hl-1">, </span><span class="hl-0">index</span><span class="hl-1">) </span><span class="hl-8">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-0">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-6">`Device #</span><span class="hl-8">${</span><span class="hl-0">index</span><span class="hl-9"> </span><span class="hl-1">+</span><span class="hl-9"> </span><span class="hl-4">1</span><span class="hl-8">}</span><span class="hl-6">: &#39;</span><span class="hl-8">${</span><span class="hl-0">device</span><span class="hl-9">.</span><span class="hl-0">name</span><span class="hl-8">}</span><span class="hl-6">&#39;`</span><span class="hl-1">);</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">}));</span>
</code><button type="button">Copy</button></pre>

<a id="md:using-promises" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Using promises<a href="#md:using-promises" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="javascript"><span class="hl-6">&#39;use strict&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-8">const</span><span class="hl-1"> </span><span class="hl-2">smartcard</span><span class="hl-1"> = </span><span class="hl-5">require</span><span class="hl-1">(</span><span class="hl-6">&#39;smartcard&#39;</span><span class="hl-1">);</span><br/><span class="hl-8">const</span><span class="hl-1"> </span><span class="hl-2">Devices</span><span class="hl-1"> = </span><span class="hl-0">smartcard</span><span class="hl-1">.</span><span class="hl-0">Devices</span><span class="hl-1">;</span><br/><span class="hl-8">const</span><span class="hl-1"> </span><span class="hl-2">devices</span><span class="hl-1"> = </span><span class="hl-8">new</span><span class="hl-1"> </span><span class="hl-5">Devices</span><span class="hl-1">();</span><br/><br/><br/><span class="hl-0">devices</span><span class="hl-1">.</span><span class="hl-5">onActivated</span><span class="hl-1">().</span><span class="hl-5">then</span><span class="hl-1">(</span><span class="hl-0">event</span><span class="hl-1"> </span><span class="hl-8">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-6">`Device &#39;</span><span class="hl-8">${</span><span class="hl-0">event</span><span class="hl-9">.</span><span class="hl-0">device</span><span class="hl-8">}</span><span class="hl-6">&#39; activated`</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-0">event</span><span class="hl-1">.</span><span class="hl-0">devices</span><span class="hl-1">.</span><span class="hl-5">map</span><span class="hl-1">((</span><span class="hl-0">device</span><span class="hl-1">, </span><span class="hl-0">index</span><span class="hl-1">) </span><span class="hl-8">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-0">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-6">`Device #</span><span class="hl-8">${</span><span class="hl-0">index</span><span class="hl-9"> </span><span class="hl-1">+</span><span class="hl-9"> </span><span class="hl-4">1</span><span class="hl-8">}</span><span class="hl-6">: &#39;</span><span class="hl-8">${</span><span class="hl-0">device</span><span class="hl-9">.</span><span class="hl-0">name</span><span class="hl-8">}</span><span class="hl-6">&#39;`</span><span class="hl-1">);</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="md:selecting-the-payment-systems-environment-on-an-emv-chip--pin-card" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Selecting the Payment Systems Environment on an EMV (Chip &amp; Pin) card<a href="#md:selecting-the-payment-systems-environment-on-an-emv-chip--pin-card" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="javascript"><span class="hl-6">&#39;use strict&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-8">const</span><span class="hl-1"> </span><span class="hl-2">smartcard</span><span class="hl-1"> = </span><span class="hl-5">require</span><span class="hl-1">(</span><span class="hl-6">&#39;smartcard&#39;</span><span class="hl-1">);</span><br/><span class="hl-8">const</span><span class="hl-1"> </span><span class="hl-2">Devices</span><span class="hl-1"> = </span><span class="hl-0">smartcard</span><span class="hl-1">.</span><span class="hl-0">Devices</span><span class="hl-1">;</span><br/><span class="hl-8">const</span><span class="hl-1"> </span><span class="hl-2">Iso7816Application</span><span class="hl-1"> = </span><span class="hl-0">smartcard</span><span class="hl-1">.</span><span class="hl-0">Iso7816Application</span><span class="hl-1">;</span><br/><br/><span class="hl-8">const</span><span class="hl-1"> </span><span class="hl-2">devices</span><span class="hl-1"> = </span><span class="hl-8">new</span><span class="hl-1"> </span><span class="hl-5">Devices</span><span class="hl-1">();</span><br/><br/><span class="hl-0">devices</span><span class="hl-1">.</span><span class="hl-5">on</span><span class="hl-1">(</span><span class="hl-6">&#39;device-activated&#39;</span><span class="hl-1">, </span><span class="hl-0">event</span><span class="hl-1"> </span><span class="hl-8">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-8">const</span><span class="hl-1"> </span><span class="hl-2">currentDevices</span><span class="hl-1"> = </span><span class="hl-0">event</span><span class="hl-1">.</span><span class="hl-0">devices</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-8">let</span><span class="hl-1"> </span><span class="hl-0">device</span><span class="hl-1"> = </span><span class="hl-0">event</span><span class="hl-1">.</span><span class="hl-0">device</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-0">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-6">`Device &#39;</span><span class="hl-8">${</span><span class="hl-0">device</span><span class="hl-8">}</span><span class="hl-6">&#39; activated, devices: </span><span class="hl-8">${</span><span class="hl-0">currentDevices</span><span class="hl-8">}</span><span class="hl-6">`</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-10">for</span><span class="hl-1"> (</span><span class="hl-8">let</span><span class="hl-1"> </span><span class="hl-0">prop</span><span class="hl-1"> </span><span class="hl-8">in</span><span class="hl-1"> </span><span class="hl-0">currentDevices</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-0">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-6">&quot;Devices: &quot;</span><span class="hl-1"> + </span><span class="hl-0">currentDevices</span><span class="hl-1">[</span><span class="hl-0">prop</span><span class="hl-1">]);</span><br/><span class="hl-1">    }</span><br/><br/><span class="hl-1">    </span><span class="hl-0">device</span><span class="hl-1">.</span><span class="hl-5">on</span><span class="hl-1">(</span><span class="hl-6">&#39;card-inserted&#39;</span><span class="hl-1">, </span><span class="hl-0">event</span><span class="hl-1"> </span><span class="hl-8">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-8">let</span><span class="hl-1"> </span><span class="hl-0">card</span><span class="hl-1"> = </span><span class="hl-0">event</span><span class="hl-1">.</span><span class="hl-0">card</span><span class="hl-1">;</span><br/><span class="hl-1">        </span><span class="hl-0">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-6">`Card &#39;</span><span class="hl-8">${</span><span class="hl-0">card</span><span class="hl-9">.</span><span class="hl-5">getAtr</span><span class="hl-9">()</span><span class="hl-8">}</span><span class="hl-6">&#39; inserted into &#39;</span><span class="hl-8">${</span><span class="hl-0">event</span><span class="hl-9">.</span><span class="hl-0">device</span><span class="hl-8">}</span><span class="hl-6">&#39;`</span><span class="hl-1">);</span><br/><br/><span class="hl-1">        </span><span class="hl-0">card</span><span class="hl-1">.</span><span class="hl-5">on</span><span class="hl-1">(</span><span class="hl-6">&#39;command-issued&#39;</span><span class="hl-1">, </span><span class="hl-0">event</span><span class="hl-1"> </span><span class="hl-8">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-0">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-6">`Command &#39;</span><span class="hl-8">${</span><span class="hl-0">event</span><span class="hl-9">.</span><span class="hl-0">command</span><span class="hl-8">}</span><span class="hl-6">&#39; issued to &#39;</span><span class="hl-8">${</span><span class="hl-0">event</span><span class="hl-9">.</span><span class="hl-0">card</span><span class="hl-8">}</span><span class="hl-6">&#39; `</span><span class="hl-1">);</span><br/><span class="hl-1">        });</span><br/><br/><span class="hl-1">        </span><span class="hl-0">card</span><span class="hl-1">.</span><span class="hl-5">on</span><span class="hl-1">(</span><span class="hl-6">&#39;response-received&#39;</span><span class="hl-1">, </span><span class="hl-0">event</span><span class="hl-1"> </span><span class="hl-8">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-0">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-6">`Response &#39;</span><span class="hl-8">${</span><span class="hl-0">event</span><span class="hl-9">.</span><span class="hl-0">response</span><span class="hl-8">}</span><span class="hl-6">&#39; received from &#39;</span><span class="hl-8">${</span><span class="hl-0">event</span><span class="hl-9">.</span><span class="hl-0">card</span><span class="hl-8">}</span><span class="hl-6">&#39; in response to &#39;</span><span class="hl-8">${</span><span class="hl-0">event</span><span class="hl-9">.</span><span class="hl-0">command</span><span class="hl-8">}</span><span class="hl-6">&#39;`</span><span class="hl-1">);</span><br/><span class="hl-1">        });</span><br/><br/><span class="hl-1">        </span><span class="hl-8">const</span><span class="hl-1"> </span><span class="hl-2">application</span><span class="hl-1"> = </span><span class="hl-8">new</span><span class="hl-1"> </span><span class="hl-5">Iso7816Application</span><span class="hl-1">(</span><span class="hl-0">card</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-0">application</span><span class="hl-1">.</span><span class="hl-5">selectFile</span><span class="hl-1">([</span><span class="hl-4">0x31</span><span class="hl-1">, </span><span class="hl-4">0x50</span><span class="hl-1">, </span><span class="hl-4">0x41</span><span class="hl-1">, </span><span class="hl-4">0x59</span><span class="hl-1">, </span><span class="hl-4">0x2E</span><span class="hl-1">, </span><span class="hl-4">0x53</span><span class="hl-1">, </span><span class="hl-4">0x59</span><span class="hl-1">, </span><span class="hl-4">0x53</span><span class="hl-1">, </span><span class="hl-4">0x2E</span><span class="hl-1">, </span><span class="hl-4">0x44</span><span class="hl-1">, </span><span class="hl-4">0x44</span><span class="hl-1">, </span><span class="hl-4">0x46</span><span class="hl-1">, </span><span class="hl-4">0x30</span><span class="hl-1">, </span><span class="hl-4">0x31</span><span class="hl-1">])</span><br/><span class="hl-1">            .</span><span class="hl-5">then</span><span class="hl-1">(</span><span class="hl-0">response</span><span class="hl-1"> </span><span class="hl-8">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">                </span><span class="hl-0">console</span><span class="hl-1">.</span><span class="hl-5">info</span><span class="hl-1">(</span><span class="hl-6">`Select PSE Response: &#39;</span><span class="hl-8">${</span><span class="hl-0">response</span><span class="hl-8">}</span><span class="hl-6">&#39; &#39;</span><span class="hl-8">${</span><span class="hl-0">response</span><span class="hl-9">.</span><span class="hl-5">meaning</span><span class="hl-9">()</span><span class="hl-8">}</span><span class="hl-6">&#39;`</span><span class="hl-1">);</span><br/><span class="hl-1">            }).</span><span class="hl-5">catch</span><span class="hl-1">(</span><span class="hl-0">error</span><span class="hl-1"> </span><span class="hl-8">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">                </span><span class="hl-0">console</span><span class="hl-1">.</span><span class="hl-5">error</span><span class="hl-1">(</span><span class="hl-6">&#39;Error:&#39;</span><span class="hl-1">, </span><span class="hl-0">error</span><span class="hl-1">, </span><span class="hl-0">error</span><span class="hl-1">.</span><span class="hl-0">stack</span><span class="hl-1">);</span><br/><span class="hl-1">            });</span><br/><br/><span class="hl-1">    });</span><br/><span class="hl-1">    </span><span class="hl-0">device</span><span class="hl-1">.</span><span class="hl-5">on</span><span class="hl-1">(</span><span class="hl-6">&#39;card-removed&#39;</span><span class="hl-1">, </span><span class="hl-0">event</span><span class="hl-1"> </span><span class="hl-8">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-0">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-6">`Card removed from &#39;</span><span class="hl-8">${</span><span class="hl-0">event</span><span class="hl-9">.</span><span class="hl-0">name</span><span class="hl-8">}</span><span class="hl-6">&#39; `</span><span class="hl-1">);</span><br/><span class="hl-1">    });</span><br/><br/><span class="hl-1">});</span><br/><br/><span class="hl-0">devices</span><span class="hl-1">.</span><span class="hl-5">on</span><span class="hl-1">(</span><span class="hl-6">&#39;device-deactivated&#39;</span><span class="hl-1">, </span><span class="hl-0">event</span><span class="hl-1"> </span><span class="hl-8">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">console</span><span class="hl-1">.</span><span class="hl-5">log</span><span class="hl-1">(</span><span class="hl-6">`Device &#39;</span><span class="hl-8">${</span><span class="hl-0">event</span><span class="hl-9">.</span><span class="hl-0">device</span><span class="hl-8">}</span><span class="hl-6">&#39; deactivated, devices: [</span><span class="hl-8">${</span><span class="hl-0">event</span><span class="hl-9">.</span><span class="hl-0">devices</span><span class="hl-8">}</span><span class="hl-6">]`</span><span class="hl-1">);</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#md:about"><span>About</span></a><a href="#md:dependencies-and-problems-debianubuntu"><span>Dependencies and problems (<wbr/>Debian/<wbr/>Ubuntu)</span></a><ul><li><a href="#md:pcsc"><span>PCSC</span></a></li><li><a href="#md:nfc-issues"><span>NFC issues</span></a></li><li><a href="#md:api"><span>API</span></a></li><li><ul><li><a href="#md:class-devices"><span>Class: <wbr/>Devices</span></a></li><li><ul><li><a href="#md:events"><span>Events</span></a></li><li><ul><li><a href="#md:event-device-activated"><span>Event: &#39;device-<wbr/>activated&#39;</span></a></li><li><a href="#md:event-device-deactivated"><span>Event: &#39;device-<wbr/>deactivated&#39;</span></a></li><li><a href="#md:event-error"><span>Event: &#39;error&#39;</span></a></li></ul></li><li><a href="#md:methods"><span>Methods</span></a></li><li><ul><li><a href="#md:constructor"><span>Constructor</span></a></li><li><a href="#md:devicesonactivated"><span>devices.on<wbr/>Activated()</span></a></li><li><a href="#md:devicesondeactivated"><span>devices.on<wbr/>Deactivated()</span></a></li><li><a href="#md:deviceslistdevices"><span>devices.list<wbr/>Devices()</span></a></li><li><a href="#md:deviceslookupname"><span>devices.lookup(name)</span></a></li></ul></li></ul></li><li><a href="#md:class-device"><span>Class: <wbr/>Device</span></a></li><li><ul><li><a href="#md:methods-1"><span>Methods</span></a></li><li><ul><li><a href="#md:devicegetname"><span>device.get<wbr/>Name()</span></a></li><li><a href="#md:devicetransmitdata-res_len-protocol-cb"><span>device.transmit(data, res_<wbr/>len, protocol, cb)</span></a></li></ul></li><li><a href="#md:events-1"><span>Events</span></a></li><li><ul><li><a href="#md:event-card-inserted"><span>Event: &#39;card-<wbr/>inserted&#39;</span></a></li><li><a href="#md:event-card-removed"><span>Event: &#39;card-<wbr/>removed&#39;</span></a></li></ul></li></ul></li><li><a href="#md:class-card"><span>Class: <wbr/>Card</span></a></li><li><ul><li><a href="#md:methods-2"><span>Methods</span></a></li><li><ul><li><a href="#md:cardgetatr"><span>card.get<wbr/>Atr()</span></a></li><li><a href="#md:cardissuecommandcommandapdu-callback"><span>card.issue<wbr/>Command(command<wbr/>Apdu, callback)</span></a></li></ul></li><li><a href="#md:events-2"><span>Events</span></a></li><li><ul><li><a href="#md:event-command-issued"><span>Event: &#39;command-<wbr/>issued&#39;</span></a></li><li><a href="#md:event-response-received"><span>Event: &#39;response-<wbr/>received&#39;</span></a></li></ul></li></ul></li><li><a href="#md:class-commandapdu"><span>Class: <wbr/>Command<wbr/>Apdu</span></a></li><li><ul><li><a href="#md:methods-3"><span>Methods</span></a></li><li><ul><li><a href="#md:constructor-commandapduobj"><span>Constructor <wbr/>Command<wbr/>Apdu(obj)</span></a></li><li><a href="#md:commandapdutobuffer"><span>Command<wbr/>Apdu.to<wbr/>Buffer()</span></a></li><li><a href="#md:commandapdutostring"><span>Command<wbr/>Apdu.to<wbr/>String()</span></a></li><li><a href="#md:commandapdutobytearray"><span>Command<wbr/>Apdu.to<wbr/>Byte<wbr/>Array()</span></a></li><li><a href="#md:commandapdusetlele"><span>Command<wbr/>Apdu.set<wbr/>Le(le)</span></a></li></ul></li></ul></li><li><a href="#md:class-responseapdu"><span>Class: <wbr/>Response<wbr/>Apdu</span></a></li><li><ul><li><a href="#md:methods-4"><span>Methods</span></a></li><li><ul><li><a href="#md:constructor-1"><span>Constructor</span></a></li><li><a href="#md:responseapdumeaning"><span>Response<wbr/>Apdu.meaning()</span></a></li><li><a href="#md:responseapdugetdataonly"><span>Response<wbr/>Apdu.get<wbr/>Data<wbr/>Only()</span></a></li><li><a href="#md:responseapdugetstatuscode"><span>Response<wbr/>Apdu.get<wbr/>Status<wbr/>Code()</span></a></li><li><a href="#md:responseapduisok"><span>Response<wbr/>Apdu.is<wbr/>Ok()</span></a></li><li><a href="#md:responseapdubuffer"><span>Response<wbr/>Apdu.buffer()</span></a></li><li><a href="#md:responseapduhasmorebytesavailable"><span>Response<wbr/>Apdu.has<wbr/>More<wbr/>Bytes<wbr/>Available()</span></a></li><li><a href="#md:responseapdunumberofbytesavailable"><span>Response<wbr/>Apdu.number<wbr/>Of<wbr/>Bytes<wbr/>Available()</span></a></li><li><a href="#md:responseapduiswronglength"><span>Response<wbr/>Apdu.is<wbr/>Wrong<wbr/>Length()</span></a></li><li><a href="#md:responseapducorrectlength"><span>Response<wbr/>Apdu.correct<wbr/>Length()</span></a></li></ul></li></ul></li><li><a href="#md:class-iso7816application"><span>Class: <wbr/>Iso7816<wbr/>Application</span></a></li><li><ul><li><a href="#md:methods-5"><span>Methods</span></a></li><li><ul><li><a href="#md:constructor-iso7816applicationcard"><span>Constructor <wbr/>Iso7816<wbr/>Application(card)</span></a></li><li><a href="#md:iso7816applicationissuecommandcommandapdu"><span>Iso7816<wbr/>Application.issue<wbr/>Command(command<wbr/>Apdu)</span></a></li><li><a href="#md:iso7816applicationselectfilebytes-p1-p2"><span>Iso7816<wbr/>Application.select<wbr/>File(bytes, p1, p2)</span></a></li><li><a href="#md:iso7816applicationgetresponselength"><span>Iso7816<wbr/>Application.get<wbr/>Response(length)</span></a></li><li><a href="#md:iso7816applicationgetresponsesfirecord"><span>Iso7816<wbr/>Application.get<wbr/>Response(sfi,record)</span></a></li><li><a href="#md:iso7816applicationgetdatap1-p2"><span>Iso7816<wbr/>Application.get<wbr/>Data(p1, p2)</span></a></li></ul></li><li><a href="#md:events-3"><span>Events</span></a></li><li><ul><li><a href="#md:event-application-selected"><span>Event: &#39;application-<wbr/>selected&#39;</span></a></li></ul></li></ul></li></ul></li><li><a href="#md:examples"><span>Examples</span></a></li><li><ul><li><a href="#md:with-event-emitter"><span>With event emitter</span></a></li><li><a href="#md:using-promises"><span>Using promises</span></a></li><li><a href="#md:selecting-the-payment-systems-environment-on-an-emv-chip--pin-card"><span>Selecting the <wbr/>Payment <wbr/>Systems <wbr/>Environment on an EMV (<wbr/>Chip &amp; <wbr/>Pin) card</span></a></li></ul></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="modules.html" class="current"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="assets/icons.svg#icon-1"></use></svg><span>Smartcard Library Documentation</span></a><ul class="tsd-small-nested-navigation" id="tsd-nav-container" data-base="."><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>
